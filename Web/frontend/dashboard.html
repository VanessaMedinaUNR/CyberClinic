<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel ="stylesheet" href="login.css">
<title> Dashboard</title>
<style> 
    body{
        display: block;
        height: auto;
        background: white;
    }
    #bounding_box{
        width:95%;
        margin: 20px auto;
        padding: 0;
        background: transparent;
        box-shadow: none;
        text-align: left;
        max-width: 1200px; 

    }
    .dashboard-header {
        background: white;
        padding: 15px 30px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }
    .brand-section h1{ 
        color: navy; 
        font-size:30px; 
        margin:0;
    }

    .brand-section p {
        color: #64748b;
        font-size: 12px;
        margin: 0;
    }
    .user-controls{
        display:flex;
        align-items:center;
        gap: 15px;
        font-size:14px;
        color: black;
    }
    table {
        width:100%; 
        border-collapse: 
        collapse;
    }
    th{ 
        text-align: left;
        padding: 15px; 
        color:black; 
        border-bottom: 1px 
        solid #eee; 
        font-size:14px;
    }
    td { 
        padding: 15px; 
        border-bottom: 1px solid #eee; 
        color: #333; 
        vertical-align:middle;
    }

    .btn-black{
        background: #0f172a;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        border:none;
        cursor:pointer;
        font-weight: bold;

    }
    

</style>
</head>
<body>
    <div id="bounding_box">
        
        <div class="dashboard-header">
            <div class="brand-section">
            <h1>CyberClinic</h1>
            <p> University of Nevada, Reno</p>
        </div>
        <div class=" user-controls">
            <span id="User-email"> user@email.com </span>
            <a href="settings.html" style="text-decoration: none;">⚙️</a>
        </div>
    </div>

    <div style=" display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1 style="font-size: 20px; color: #333; margin: 0;">Dashboard </h1>
        <button class="btn-black" id = "newScan" onclick="window.location.href='newscan.html'">+ Configure New Scan </button>
    </div> 

    <div class="content-card">
        <div class="card-title-row">
            <h2>Active scans & Reports </h2>
        </div>
        <table id="scans-table">
            <thead>
                <tr>
                    <th>Name / Target </th>
                    <th> Date (last Run) </th>
                    <th> Scan Type</th>
                    <th> Status</th>
                    <th style="text-align: right;">Actions </th>
                </tr>
            </thead>
                <tbody>
            
                </tbody>
            
        </table>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", async function () {
        await loadscans();
    });
    
    async function loadscans() {
        try {
            const response = await fetch("http://localhost:5000/api/scans/list", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
    
            if (!response.ok) {
                throw new Error("Failed to connect to server");
            }
    
            const data = await response.json();
            const scans = data.scans;
    
            const tableBody = document.querySelector("#scans-table tbody");
            tableBody.innerHTML = "";
    
            if (!scans || scans.length === 0) {
                tableBody.innerHTML =
                    "<tr><td colspan='5' style='text-align:center'> No Scans found.</td></tr>";
                return;
            }
    
            // ✅ fixed forEach block
            scans.forEach(scan => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>
                        <strong>${scan.target.name}</strong><br>
                        <span style="font-size: 12px; color: #666;">${scan.target.value}</span>
                    </td>
                    <td>${new Date(scan.created_at).toLocaleDateString()}</td>
                    <td>${scan.scan_type}</td>
                    <td>
                        <span style="color: ${getStatusColor(scan.status)}; font-weight: bold;">
                            ${scan.status}
                        </span>
                    </td>
                    <td style="text-align: right;">
                        <button class="btn-black" 
                                onclick="window.location.href='report.html?id=${scan.scan_id}'"
                                style="padding: 5px 10px; font-size: 12px;">
                            View Report
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });  // <-- now both } and ) are in correct order
    
        } catch (error) {
            console.error("Error:", error);
        }
    }
    
    function getStatusColor(status) {
        if (status === 'completed') return 'green';
        if (status === 'failed') return 'red';
        if (status === 'pending') return 'orange';
        return 'black';
    }
    </script>
    
</body>
</html>

        
//         document.getElementById("loginForm").addEventListener("submit", async function(event) {
    //         event.preventDefault(); 
            
    //         const email = document.getElementById("email").value;
    //         const password = document.getElementById("password").value;
        
            
    //         const response = await fetch("http://localhost:5000/api/auth/submit", {
    //             method: "POST",
    //             headers: {
    //                 "Content-Type": "application/json"
    //             },
    //             body: JSON.stringify({
    //                 email: email,
    //                 password: password
    //             })
    //         });
        
    //         const result = await response.json();
    //         console.log(result);
        
    //         if (response.ok) {
                
    //             window.location.href = "dashboard.html"; 
    //         } else {
    //             alert(result.error || "Login failed.");
    //         }
    //    });